var draw=function(){var e=document.querySelector("main"),t=e.offsetWidth,n=e.offsetHeight,r=document.createElement("canvas"),l=r.getContext("2d"),o=r.getBoundingClientRect(),i=0,a=0,s=0,d=0,c=0,h=0,u=!1,f=!1,y="",g=!1,w="",k="",m=[],S=0,p=[];return{setIsDrawing:function(e){g=e},getIsDrawing:function(){return g},getShape:function(){return y},setShape:function(e){y=e},randColor:function(){return"#"+Math.floor(16777215*Math.random()).toString(16)},setStrokeColor:function(e){w=e},setFillColor:function(e){k=e},getStrokeColor:function(){return 6<w.length?w:this.randColor()},getFillColor:function(){return 6<k.length?k:this.randColor()},setStart:function(){s=i,d=a},setEnd:function(){c=i,h=a},setPoint:function(){m[S]=[],m[S].x=i,m[S].y=a,2<m.length?(this.draw(),S=0,m=[]):S++},setXY:function(e){u=i,f=a,i=e.clientX-o.left-r.offsetLeft,a=e.clientY-o.top-r.offsetTop},writeXY:function(){document.getElementById("trackX").innerHTML="X: "+i,document.getElementById("trackY").innerHTML="Y: "+a},draw:function(){switch(l.restore(),y){case"rectangle":this.drawRect();break;case"line":this.drawLine();break;case"circle":this.drawCircle();break;case"path":this.drawPath();break;case"triangle":this.drawTriangle();break;case"3-point":this.draw3Point();break;default:alert("Please choose a shape")}l.save()},drawRect:function(){l.fillStyle=this.getFillColor(),l.strokeStyle=this.getStrokeColor(),l.fillRect(s,d,c-s,h-d),p.push({shape:"rectangle",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:l.strokeStyle,fill:l.fillStyle}})},drawLine:function(){l.strokeStyle=this.getStrokeColor(),l.beginPath(),l.moveTo(s,d),l.lineTo(c,h),l.stroke(),p.push({shape:"line",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:l.strokeStyle}})},drawCircle:function(){l.strokeStyle=this.getStrokeColor(),l.fillStyle=this.getFillColor();var e=s-c,t=d-h,n=Math.sqrt(e*e+t*t);l.beginPath(),l.arc(s,d,n,0,2*Math.PI),l.stroke(),l.fill(),p.push({shape:"circle",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:l.strokeStyle,fill:l.fillStyle}})},drawPath:function(){l.strokeStyle=this.getStrokeColor(),l.beginPath(),l.moveTo(u,f),l.lineTo(i,a),l.stroke(),p.push({shape:"path",cords:{lx:u,ly:f,x:i,y:a},styles:{stroke:l.strokeStyle}})},drawTriangle:function(){var e=s-c,t=d-h,n=Math.sqrt(e*e+t*t),r=s+n,o=d+n;c<s&&(r=s-n),h<d&&(o=d-n),l.fillStyle=this.getFillColor(),l.strokeStyle=this.getStrokeColor(),l.beginPath(),l.moveTo(s,d),l.lineTo(r,o),l.lineTo(c,h),l.lineTo(s,d),l.stroke(),l.fill(),p.push({shape:"triangle",cords:{x1:s,y1:d,x2:c,y2:h},styles:{stroke:l.strokeStyle,fill:l.fillStyle}})},draw3Point:function(){l.fillStyle=this.getFillColor(),l.strokeStyle=this.getStrokeColor(),l.beginPath(),l.moveTo(m[0].x,m[0].y),l.lineTo(m[1].x,m[1].y),l.lineTo(m[2].x,m[2].y),l.lineTo(m[0].x,m[0].y),l.stroke(),l.fill(),p.push({shape:"3-point",cords:{points:m},styles:{stroke:l.strokeStyle,fill:l.fillStyle}})},clear:function(){r.width=r.width},redraw:function(){for(item in p){var e=p[item].shape,t=p[item];switch(e){case"path":y=p[item].shape,u=t.cords.lx,f=t.cords.ly,i=t.cords.x,a=t.cords.y,l.strokeStyle=t.styles.stroke;break;case"circle":case"line":case"rectangle":case"triangle":y=p[item].shape,s=t.cords.x1,d=t.cords.y1,c=t.cords.x2,h=t.cords.y2,l.fillStyle=t.styles.fill,l.strokeStyle=t.styles.stroke;break;case"3-point":y=p[item].shape,m=t.cords.points,l.strokeStyle=t.styles.stroke,l.fillStyle=t.styles.fill}this.draw()}},getCanvas:function(){return r},init:function(){r.width=t,r.height=n,e.appendChild(r)}}}();draw.init(),document.getElementById("btnRect").addEventListener("click",function(){draw.setShape("rectangle")}),document.getElementById("btnLine").addEventListener("click",function(){draw.setShape("line")}),document.getElementById("btnCircle").addEventListener("click",function(){draw.setShape("circle")}),document.getElementById("btnPath").addEventListener("click",function(){draw.setShape("path")}),document.getElementById("btnTriangle").addEventListener("click",function(){draw.setShape("triangle")}),document.getElementById("btn3Point").addEventListener("click",function(){draw.setShape("3-point")}),document.getElementById("btnClear").addEventListener("click",function(){confirm("Are you sure you want to clear the canvas?")&&draw.clear()}),document.getElementById("btnRedraw").addEventListener("click",function(){confirm("Are you sure you want to redraw the canvas?")&&draw.redraw()}),draw.getCanvas().addEventListener("mousedown",function(){"3-point"!==draw.getShape()&&(draw.setStart(),draw.setIsDrawing(!0)),"3-point"===draw.getShape()&&draw.setPoint()}),draw.getCanvas().addEventListener("mouseup",function(){"3-point"!==draw.getShape()&&(draw.setEnd(),draw.draw(),draw.setIsDrawing(!1))}),draw.getCanvas().addEventListener("mousemove",function(e){draw.setXY(e),draw.writeXY(),"path"===draw.getShape()&&!0===draw.getIsDrawing()&&draw.draw()}),document.getElementById("strokeColor").addEventListener("change",function(){draw.setStrokeColor(document.getElementById("strokeColor").value)}),document.getElementById("randStrokeColor").addEventListener("change",function(){draw.setStrokeColor("")}),document.getElementById("fillColor").addEventListener("change",function(){draw.setFillColor(document.getElementById("fillColor").value)}),document.getElementById("randFillColor").addEventListener("change",function(){draw.setFillColor("")});